# PTaaS Engagement Lifecycle Automation Templates

This directory contains **10 ready-to-use automation workflow templates** designed specifically for **Penetration Testing as a Service (PTaaS)** engagements. These templates cover the complete engagement lifecycle from kickoff to closure, automating critical communication, triage, ticketing, and reporting workflows.

---

## 📋 Table of Contents

1. [Engagement Lifecycle Overview](#engagement-lifecycle-overview)
2. [Templates by Phase](#templates-by-phase)
3. [Template Details & Usage](#template-details--usage)
4. [Configuration Guide](#configuration-guide)
5. [Best Practices](#best-practices)
6. [Integration Points](#integration-points)

---

## 🔄 Engagement Lifecycle Overview

A typical PTaaS engagement follows this lifecycle:

```
┌─────────────────┐
│   1. KICKOFF    │  ← Engagement creation, stakeholder onboarding
└────────┬────────┘
         ↓
┌─────────────────┐
│  2. EXECUTION   │  ← Vulnerability discovery, triage, ticketing
└────────┬────────┘
         ↓
┌─────────────────┐
│ 3. REMEDIATION  │  ← Status tracking, SLA monitoring, escalation
└────────┬────────┘
         ↓
┌─────────────────┐
│  4. REPORTING   │  ← Weekly digests, PDF generation
└────────┬────────┘
         ↓
┌─────────────────┐
│  5. RETESTING   │  ← Verify fixes, reopen if needed
└────────┬────────┘
         ↓
┌─────────────────┐
│  6. CLOSURE     │  ← Final summary, lessons learned
└─────────────────┘
```

Each phase has specific automation needs, and our templates address them systematically.

---

## 📂 Templates by Phase

### **Phase 1: Kickoff (Templates 01)**
- `01-engagement-kickoff-email.json` - Welcome email to stakeholders with scope, timeline, SLAs

### **Phase 2: Execution (Templates 02-05)**
- `02-high-critical-auto-ticketing.json` - Auto-create Jira tickets for high/critical findings
- `03-auto-assign-to-asset-owner.json` - Auto-assign findings to asset owners with triage checklist
- `04-daily-engagement-status-update.json` - Daily summary of new/resolved findings
- `05-exploit-patch-availability-alert.json` - Urgent alerts when exploits or patches are available

### **Phase 3: Remediation (Templates 06-07)**
- `06-finding-state-change-notification.json` - Notify on state changes (New→Active→Resolved)
- `07-sla-watch-escalation.json` - Daily SLA monitoring with escalation for overdue items

### **Phase 4: Reporting (Template 08)**
- `08-weekly-pdf-report-generation.json` - Auto-generate and email weekly PDF reports

### **Phase 5: Retesting (Template 09)**
- `09-retest-request-acknowledgment.json` - Acknowledge resolved findings for retest queue

### **Phase 6: Closure (Template 10)**
- `10-engagement-closure-summary.json` - Comprehensive closure report with metrics

---

## 📖 Template Details & Usage

### **01 - Engagement Kickoff Email**
**Trigger:** `on_engagement_create` (Real-time)  
**Purpose:** Automatically send welcome email and Slack notification when a new engagement is created  
**Recipients:** Stakeholders, pentest team, project managers  

**What it does:**
- Welcomes team to the engagement
- Shares scope, timeline, and SLA commitments
- Sets expectations for communication channels
- Provides next steps and authorization reminders

**When to use:**
- Every new engagement
- PTaaS kickoff phase
- Client onboarding

---

### **02 - High/Critical Auto-Ticketing**
**Trigger:** `on_bug_create` (Real-time)  
**Purpose:** Automatically create Jira tickets for high/critical severity findings  
**Recipients:** Development teams, asset owners  

**What it does:**
- Creates Jira ticket with severity, description, asset
- Tags with appropriate labels (security, critical, strobes-auto)
- Adds comment to Strobes finding with ticket link
- Sends Slack notification

**When to use:**
- All high/critical findings
- Integrations with Jira/Azure Boards
- When immediate ticketing is required

**Configuration needed:**
- Update `project_key` to your Jira project
- Update `issue_type` if not using "Bug"
- Customize labels and custom_fields

---

### **03 - Auto-Assign to Asset Owner**
**Trigger:** `on_bug_create` (Real-time)  
**Purpose:** Automatically assign new findings to asset/application owners  
**Recipients:** Asset owners  

**What it does:**
- Assigns finding to responsible owner
- Adds triage checklist as comment
- Sets custom field "triage_status" to "Pending Owner Review"
- Notifies via Slack

**When to use:**
- All new findings (state=New)
- When asset ownership is well-defined
- To enforce triage accountability

**Configuration needed:**
- Map assets to owner IDs in pipelineCode
- Update custom field slug if different

---

### **04 - Daily Engagement Status Update**
**Trigger:** Scheduled daily at 09:00 UTC  
**Purpose:** Daily digest of engagement progress  
**Recipients:** Stakeholders, pentest team  

**What it does:**
- Counts new/resolved/active findings
- Breaks down by severity (Critical/High/Medium/Low)
- Lists top 5 affected assets
- Sent via Slack and Email

**When to use:**
- During active engagements
- For daily standup preparation
- To keep stakeholders informed

**Configuration needed:**
- Adjust scheduleTime to your timezone
- Update recipient emails

---

### **05 - Exploit/Patch Availability Alert**
**Trigger:** `on_bug_create` (Real-time)  
**Purpose:** Urgent alerts when public exploits or vendor patches are available  
**Recipients:** Security urgent team, asset owners  

**What it does:**
- Detects exploit_available or patch_available flags
- Tags findings appropriately
- Sets urgency custom field
- Provides remediation recommendations
- Escalates to security-urgent channel

**When to use:**
- All findings with exploit/patch data
- High-risk situations requiring immediate action
- Compliance with patch management policies

**Configuration needed:**
- Ensure custom field "remediation_urgency" exists
- Update urgent email recipients

---

### **06 - Finding State Change Notification**
**Trigger:** `on_bug_state_update` (Real-time)  
**Purpose:** Notify stakeholders when finding state changes  
**Recipients:** Stakeholders, assignees  

**What it does:**
- Tracks state transitions (New→Active→Resolved, etc.)
- Detects reopened findings
- Contextual messages based on new state
- Email and Slack notifications

**When to use:**
- All state changes
- To track remediation progress
- To alert on reopened findings

---

### **07 - SLA Watch & Escalation**
**Trigger:** Scheduled daily at 08:00 UTC  
**Purpose:** Monitor SLA compliance and escalate overdue items  
**Recipients:** Management, asset owners, pentest team  

**What it does:**
- Counts findings due soon (≤3 days) and overdue
- Breaks down overdue by severity
- Lists top assets with overdue findings
- Escalates to management via email
- Updates SLA status custom field

**When to use:**
- All active engagements
- When SLA compliance is critical
- For management visibility

**Configuration needed:**
- Adjust due_soon threshold (currently 3 days)
- Update management email list

---

### **08 - Weekly PDF Report Generation**
**Trigger:** Scheduled weekly (Friday 17:00 UTC)  
**Purpose:** Auto-generate and email comprehensive PDF report  
**Recipients:** Executives, stakeholders, pentest team  

**What it does:**
- Generates PDF report from template
- Includes new/resolved/open findings
- Severity breakdown and top assets
- Email with PDF attachment
- Slack notification

**When to use:**
- Weekly reporting cadence
- Executive updates
- Compliance documentation

**Configuration needed:**
- Set `report_template_id` to your report template
- Update scheduleDayOfWeek (1=Monday, 5=Friday)
- Adjust scheduleTime for your timezone

---

### **09 - Retest Request Acknowledgment**
**Trigger:** `on_bug_state_update` (when state=Resolved)  
**Purpose:** Queue resolved findings for retesting  
**Recipients:** Pentest team, asset owners  

**What it does:**
- Detects when findings are marked Resolved
- Sets retest_status custom field to "Pending Retest"
- Adds retest checklist as comment
- Notifies pentest team to schedule retest
- Provides 3-5 day SLA expectation

**When to use:**
- All resolved findings requiring verification
- Retest phase of engagement
- Quality assurance process

**Configuration needed:**
- Ensure custom field "retest_status" exists
- Update retest SLA timeline if different

---

### **10 - Engagement Closure Summary**
**Trigger:** Scheduled (manual trigger or end-of-engagement)  
**Purpose:** Comprehensive closure report with metrics  
**Recipients:** Executives, stakeholders, pentest team  

**What it does:**
- Summarizes total findings by severity
- Calculates resolution metrics (resolved %, MTTR)
- Lists top affected assets
- Provides recommendations and next steps
- Sent via email with Slack notification

**When to use:**
- End of engagement
- Final deliverable
- Lessons learned sessions

**Configuration needed:**
- Trigger manually or schedule for engagement end date
- Update engagement_name in pipelineCode
- Add MTTR calculation if available

---

## ⚙️ Configuration Guide

### **Step 1: Update Communication Channels**

For **every template**, update:

```json
"slack": {
  "webhook_url": "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
}

"email": {
  "to": ["your-team@example.com"],
  "cc": ["cc-recipient@example.com"]
}
```

### **Step 2: Configure Jira Integration (Template 02)**

```json
"jira": {
  "project_key": "YOUR_PROJECT",  // e.g., "SEC"
  "issue_type": "Bug",            // or "Story", "Task"
  "priority": "Highest"           // Based on severity
}
```

### **Step 3: Set Timezone & Schedule Times**

All scheduled templates use UTC by default. Update:

```json
"scheduleTime": "09:00",  // HH:MM format
"timezone": "America/New_York"  // Your timezone
```

### **Step 4: Map Asset Owners (Template 03)**

Update the pipelineCode to map assets to owner IDs:

```python
def run_pipeline(obj):
    # Map asset names to user IDs
    asset_owner_map = {
        'web-app-prod': 'user-id-123',
        'api-gateway': 'user-id-456',
        # Add your mappings
    }
    asset_name = getattr(getattr(obj, 'asset', None), 'name', '')
    owner_id = asset_owner_map.get(asset_name, 'default-owner-id')
    # ... rest of code
```

### **Step 5: Custom Field Configuration**

Ensure these custom fields exist in your Strobes instance:

**Findings:**
- `triage_status` (Template 03)
- `remediation_urgency` (Template 05)
- `sla_status` (Template 07)
- `retest_status` (Template 09)

**Create via:** Settings → Custom Fields → Add Field

---

## 🎯 Best Practices

### **1. Start Small**
- Begin with Templates 01, 02, 04 (kickoff, ticketing, daily digest)
- Add more as your team becomes comfortable

### **2. Test in Staging**
- Import templates to a test engagement first
- Verify Slack/Email delivery
- Check custom field mappings

### **3. Customize Messages**
- Tailor email/Slack templates to your org's tone
- Add company branding and links
- Include specific SLA commitments

### **4. Monitor Automation Logs**
- Check automation activity logs weekly
- Fix any failed runs immediately
- Adjust schedules based on team feedback

### **5. Review and Iterate**
- Collect feedback from stakeholders
- Adjust notification frequency
- Refine severity thresholds

### **6. Document Exceptions**
- Some findings may need manual handling
- Document when to override automations
- Train team on exception processes

---

## 🔗 Integration Points

### **Jira/Azure Boards**
- Template 02 creates tickets automatically
- Bi-directional sync recommended
- Use webhook for ticket updates back to Strobes

### **Slack**
- All templates support Slack notifications
- Create dedicated channels (#security-alerts, #engagement-updates)
- Use @mentions sparingly to avoid noise

### **Email**
- SMTP or O365 supported
- Set appropriate reply-to addresses
- Use distribution lists for stakeholder groups

### **PDF Reports**
- Configure report template in Strobes (Settings → Reports)
- Set `report_template_id` in Template 08
- Test PDF generation before scheduling

---

## 📊 Success Metrics

Track these KPIs to measure automation effectiveness:

- **Time to Assignment:** Average time from finding creation to owner assignment
- **SLA Compliance:** % of findings resolved within SLA
- **Ticketing Rate:** % of critical/high findings auto-ticketed
- **Communication Reach:** Stakeholder engagement with daily/weekly digests
- **Retest Cycle Time:** Average time from resolved to retested
- **Manual Override Rate:** % of automations that require manual intervention

---

## 🆘 Troubleshooting

### **Issue: Slack messages not received**
- Check webhook URL is valid
- Test webhook with curl: `curl -X POST -H 'Content-type: application/json' --data '{"text":"Test"}' YOUR_WEBHOOK_URL`
- Verify Slack app permissions

### **Issue: Emails not delivered**
- Check SMTP/O365 credentials in Strobes
- Verify recipient emails are valid
- Check spam/junk folders
- Review email delivery logs

### **Issue: Jira tickets not created**
- Verify Jira API credentials
- Check project_key exists
- Ensure issue_type is allowed in project
- Review Jira webhook logs

### **Issue: Custom fields not updating**
- Verify custom field slug matches exactly
- Check field permissions (read/write)
- Ensure field type is compatible

### **Issue: Schedule not running**
- Check scheduleTime is in 24-hour format (HH:MM)
- Verify timezone setting
- Ensure workflow is enabled (not paused)

---

## 📚 Additional Resources

- **Strobes Automation Documentation:** [Link to docs]
- **RQL Search Query Guide:** [Link to RQL docs]
- **Custom Fields Guide:** [Link to custom fields docs]
- **Pipeline Code Examples:** [Link to examples]

---

## 🤝 Support

For issues or questions:
- Email: support@strobes.co
- Slack: #strobes-support
- Documentation: docs.strobes.co

---

## 📝 License & Usage

These templates are provided as-is for Strobes customers. Customize freely for your organization's needs.

**Version:** 1.0  
**Last Updated:** 2025-10-08  
**Maintained by:** Strobes Security Team

